<!DOCTYPE html>
<html>
  <head>
    <title>VR Dat GUI Examples</title>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui" name="viewport" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>

    <script type="text/javascript" src="thirdparty/three.js"></script>
    <script type="text/javascript" src="dist/vrviewer.js"></script>
    <script type="text/javascript" src="dist/vrpad.js"></script>
    <script type="text/javascript">

      const { scene, camera, events, toggleVR, controllerModels, renderer } = VRViewer({
        autoEnter: true,
        emptyRoom: true
      });

      const vrpad = VRPad();

      //  update vrpad, best on requestAnimationFrame which is what 'tick' fires on
      events.on( 'tick', (dt)=>{
        vrpad.update();
      });

      //  an example cube stuck to our right hand
      const box = new THREE.Mesh( new THREE.BoxGeometry( 0.1, 0.1, 0.1 ), new THREE.MeshStandardMaterial({color:0xaaff33}));
      controllerModels[ 0 ].add( box );

      events.on( 'tick', ()=>{
        if( box.update ){
          box.update();
        }
      });

      //  right hand on Vive
      vrpad.events.on( 'connected0', ( pad ) => {

        //  trigger button
        pad.on('button1Pressed', ()=>{
          box.position.set( 0, 0, -1 );
          box.scale.set( 3, 3, 3 );

          //  cause the box to rotate per frame
          box.update = function(){
            box.rotation.y += 0.08;
          };
        });

        pad.on('button1Released', ()=>{
          box.position.set( 0, 0, 0 );
          box.scale.set( 1, 1, 1 );
          delete box.update;
        });

        //  option button
        pad.on('button3Pressed', function( index, value ){
          toggleVR();
        });
      });


      //  left hand on Vive
      vrpad.events.on( 'connected1', ( pad ) => {

        //  option button
        pad.on('button3Pressed', function( index, value ){
          console.log( index, value );
        });
      });

    </script>

  </body>
</html>